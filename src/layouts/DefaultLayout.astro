---
import Footer from "./Footer.astro";

const { title } = Astro.props;
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title title={title}></title>
  </head>
  <body>
    <canvas id="gridCanvas"></canvas>
    <slot />
    <Footer />
  </body>
</html>

<style>
  canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: -1;
    pointer-events: all;
  }
</style>

<script>
  const canvas = document.getElementById("gridCanvas") as HTMLCanvasElement;
  const ctx = canvas.getContext("2d")!;

  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }

  resizeCanvas();

  const gridSize = 50;
  const glowRadius = 150;
  let mouseX = -1000;
  let mouseY = -1000;

  canvas.addEventListener("mousemove", (e) => {
    mouseX = e.clientX;
    mouseY = e.clientY;
  });

  canvas.addEventListener("mouseleave", () => {
    mouseX = -1000;
    mouseY = -1000;
  });

  function drawGrid() {
    ctx.fillStyle = "#1a0b2e";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    for (let x = 0; x <= canvas.width; x += gridSize) {
      for (let y = 0; y <= canvas.height; y += gridSize) {
        const distance = Math.sqrt((x - mouseX) ** 2 + (y - mouseY) ** 2);
        const opacity = Math.max(0, 1 - distance / glowRadius);

        if (opacity > 0) {
          ctx.shadowBlur = 15 * opacity;
          ctx.shadowColor = `rgba(147, 51, 234, ${opacity})`;
        } else {
          ctx.shadowBlur = 0;
        }

        ctx.strokeStyle = `rgba(255, 255, 255, ${0.2 + opacity * 0.8})`;
        ctx.lineWidth = 1 + opacity;

        ctx.beginPath();
        ctx.moveTo(x, y);
        ctx.lineTo(x + gridSize, y);
        ctx.lineTo(x + gridSize, y + gridSize);
        ctx.stroke();
      }
    }
  }

  function animate() {
    drawGrid();
    requestAnimationFrame(animate);
  }

  window.addEventListener("resize", resizeCanvas);

  animate();
</script>
